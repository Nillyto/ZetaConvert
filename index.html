<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ZetaConvert — Conversor online</title>
  <meta name="description" content="ZetaConvert: convierte imágenes y pronto texto, extras y 3D. Rápido, simple y profesional." />
  <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='64' height='64'%3E%3Crect width='100%25' height='100%25' fill='white'/%3E%3Ctext x='50%25' y='55%25' font-size='40' text-anchor='middle' fill='black' font-family='system-ui, sans-serif'%3EZ%3C/text%3E%3C/svg%3E">
  <style>
    :root {
      --bg:#ffffff;         /* blanco */
      --fg:#0b0b0b;         /* negro suave */
      --muted:#6b6b6b;      /* gris texto secundario */
      --line:#e6e6e6;       /* líneas/contornos */
      --accent:#e1192a;     /* rojo primario */
      --accent-dark:#c11522;/* rojo hover */
      --surface:#f8f8f8;    /* bloques suaves */
      --ok:#0a8a5b;
      --warn:#ad7c00;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; background:var(--bg); color:var(--fg);
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, "Noto Sans", "Helvetica Neue", sans-serif;
    }
    a{color:inherit; text-decoration:none}
    /* Header */
    header{
      position:sticky; top:0; z-index:10;
      background:rgba(255,255,255,.92); backdrop-filter:saturate(1.2) blur(6px);
      border-bottom:1px solid var(--line);
    }
    .nav{
      max-width:1080px; margin:0 auto; padding:14px 16px;
      display:flex; align-items:center; justify-content:space-between; gap:16px;
    }
    .brand{display:flex; align-items:center; gap:10px; font-weight:800; letter-spacing:.2px}
    .badge{font-size:.8rem; color:var(--muted)}
    .cta{
      display:inline-flex; align-items:center; gap:10px;
      background:var(--fg); color:#fff; padding:10px 14px; border-radius:10px; font-weight:700;
      border:1px solid var(--fg);
    }
    .cta:hover{filter:brightness(0.95)}
    /* Main layout */
    main{max-width:1080px; margin:28px auto; padding:0 16px; display:grid; gap:20px}
    .hero{
      display:grid; gap:10px; padding:18px; border:1px solid var(--line); border-radius:14px;
      background:linear-gradient(180deg, #fff, #fafafa);
    }
    .hero h1{margin:0;font-size:clamp(1.4rem,3.6vw,2.2rem)}
    .hero p{margin:0; color:var(--muted)}
    /* Category selector (tabs) */
    .tabs{
      display:flex; flex-wrap:wrap; gap:8px; padding:8px; border:1px solid var(--line); border-radius:12px; background:var(--surface)
    }
    .tab{
      appearance:none; border:1px solid var(--line); background:#fff; color:var(--fg);
      padding:10px 14px; border-radius:10px; cursor:pointer; font-weight:600;
    }
    .tab[aria-selected="true"]{ border-color:var(--accent); color:#fff; background:var(--accent) }
    .tab:not([aria-selected="true"]):hover{ border-color:#dcdcdc }
    /* Panels */
    .panel{
      border:1px solid var(--line); border-radius:12px; padding:18px; background:#fff;
    }
    .panel h2{margin:0 0 10px}
    .grid2{display:grid; grid-template-columns:1fr 1fr; gap:12px}
    @media (max-width:860px){ .grid2{grid-template-columns:1fr} }
    label{font-size:.95rem; font-weight:600}
    select,input[type=file],input[type=range],input[type=color],button{
      width:100%; padding:12px; border-radius:10px; border:1px solid var(--line); background:#fff; color:var(--fg);
    }
    input[type=range]{padding:6px}
    button{
      background:var(--accent); color:#fff; border:1px solid var(--accent); font-weight:800; cursor:pointer;
    }
    button[disabled]{opacity:.55; cursor:not-allowed}
    button:hover:not([disabled]){ background:var(--accent-dark); border-color:var(--accent-dark) }
    .muted{color:var(--muted)}
    .mono{font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace;}
    .note{padding:10px 12px; border-radius:10px; border:1px dashed var(--line); background:var(--surface); color:var(--muted)}
    /* Progress */
    .progress{height:12px; border:1px solid var(--line); border-radius:999px; overflow:hidden; background:#fff}
    .bar{height:100%; width:0%; background:var(--accent); transition:width .12s linear}
    /* Footer */
    footer{border-top:1px solid var(--line); margin-top:24px}
    .foot{max-width:1080px; margin:0 auto; padding:18px 16px; display:flex; align-items:center; justify-content:space-between; color:var(--muted); font-size:.95rem}
  </style>
</head>
<body>
  <!-- Header -->
  <header>
    <div class="nav" role="navigation" aria-label="principal">
      <div class="brand" aria-label="ZetaConvert">
        <svg width="28" height="28" viewBox="0 0 24 24" aria-hidden="true"><rect x="2" y="2" width="20" height="20" rx="5" fill="white" stroke="black"/><path d="M7 7h10l-10 10h10" stroke="#e1192a" stroke-width="2" fill="none"/></svg>
        <span>ZetaConvert</span>
        <span class="badge">simple. rápido. pro.</span>
      </div>
      <a class="cta" href="#convertir">Empezar</a>
    </div>
  </header>

  <main>
    <!-- Hero -->
    <section class="hero" id="convertir">
      <h1>Convertí archivos sin complicarte</h1>
      <p>Elegí qué querés transformar: <strong>Imágenes</strong> (activo) y pronto <strong>Texto</strong>, <strong>Extras</strong>, <strong>3D</strong>. Minimal, rápido y con foco en resultados.</p>
    </section>

    <!-- Tabs -->
    <nav class="tabs" role="tablist" aria-label="categorías">
      <button class="tab" role="tab" aria-selected="true" aria-controls="tab-imagenes" id="t-imagenes">Imágenes</button>
      <button class="tab" role="tab" aria-selected="false" aria-controls="tab-texto" id="t-texto">Texto</button>
      <button class="tab" role="tab" aria-selected="false" aria-controls="tab-extras" id="t-extras">Extras</button>
      <button class="tab" role="tab" aria-selected="false" aria-controls="tab-3d" id="t-3d">3D</button>
    </nav>

    <!-- Panel: Imágenes -->
    <section class="panel" id="tab-imagenes" role="tabpanel" aria-labelledby="t-imagenes">
      <h2 style="margin-bottom:6px">Imágenes</h2>
      <p class="muted" style="margin-top:0">Formatos soportados: JPG, PNG, WEBP, BMP, TIFF, GIF (primera frame).</p>

      <!-- Target formats -->
      <div class="grid2" style="margin-top:8px">
        <div>
          <label for="file">Archivo</label>
          <input id="file" type="file" accept="image/*" />
          <div class="muted mono" id="fileInfo" style="margin-top:6px">No hay archivo</div>
        </div>
        <div>
          <label for="target">Convertir a</label>
          <select id="target" disabled>
            <option value="">Elegí un formato…</option>
          </select>
          <div class="note" style="margin-top:6px">
            Consejo: para **fondo transparente**, elegí <strong>PNG</strong> y activá “Eliminar fondo”.
          </div>
        </div>
      </div>

      <!-- Opciones avanzadas -->
      <div class="grid2" style="margin-top:10px">
        <div>
          <label class="mono" style="display:flex;align-items:center;gap:10px">
            <input id="removeBg" type="checkbox" disabled />
            Eliminar fondo (solo PNG)
          </label>
        </div>
        <div>
          <label for="tolerance">Tolerancia</label>
          <input id="tolerance" type="range" min="0" max="100" value="35" disabled />
          <div class="muted mono">Valor: <span id="tolVal">35</span></div>
        </div>
      </div>

      <div class="grid2" style="margin-top:10px">
        <div>
          <label for="mode">Modo</label>
          <select id="mode" disabled>
            <option value="auto">Auto (color del borde)</option>
            <option value="color">Color manual</option>
          </select>
        </div>
        <div>
          <label for="color">Color del fondo (manual)</label>
          <input id="color" type="color" value="#ffffff" disabled />
          <div class="muted">Tip: con “Color manual”, vas a poder **hacer clic en la previsualización** para tomar el color exacto.</div>
        </div>
      </div>

      <!-- Preview -->
      <div style="margin-top:12px">
        <canvas id="preview" aria-label="Previsualización" style="width:100%;max-height:360px;background:#fff;border:1px solid var(--line);border-radius:10px"></canvas>
      </div>

      <!-- Acciones -->
      <div class="grid2" style="margin-top:14px">
        <button id="convertBtn" disabled>Convertir</button>
        <button id="downloadBtn" disabled>Descargar</button>
      </div>

      <!-- Progreso -->
      <div style="margin-top:14px">
        <div class="progress" aria-label="Progreso">
          <div class="bar" id="bar"></div>
        </div>
        <div class="muted mono" id="status" style="margin-top:6px">Esperando archivo…</div>
      </div>
    </section>

    <!-- Panel: Texto -->
    <section class="panel" id="tab-texto" role="tabpanel" aria-labelledby="t-texto" hidden>
      <h2 style="margin-bottom:6px">Texto</h2>
      <p class="muted">Próximamente: PDF ↔ DOCX, TXT ↔ PDF, subtítulos y más.</p>
      <div class="grid2" style="margin-top:8px">
        <div>
          <label for="file-texto">Archivo</label>
          <input id="file-texto" type="file" accept=".txt,.pdf,.doc,.docx,.rtf" disabled />
          <div class="muted mono" style="margin-top:6px">Disponible pronto</div>
        </div>
        <div>
          <label for="target-texto">Convertir a</label>
          <select id="target-texto" disabled>
            <option value="">Elegí un formato…</option>
            <option>PDF</option>
            <option>DOCX</option>
            <option>TXT</option>
          </select>
        </div>
      </div>
      <div class="note" style="margin-top:12px">¿Querés que prioricemos algún flujo de texto? Mandanos feedback.</div>
    </section>

    <!-- Panel: Extras -->
    <section class="panel" id="tab-extras" role="tabpanel" aria-labelledby="t-extras" hidden>
      <h2 style="margin-bottom:6px">Extras</h2>
      <p class="muted">Próximamente: comprimir, redimensionar por lote, convertir metadatos.</p>
      <div class="note">Estamos trabajando en esto. Si tenés una necesidad puntual, contanos y lo sumamos.</div>
    </section>

    <!-- Panel: 3D -->
    <section class="panel" id="tab-3d" role="tabpanel" aria-labelledby="t-3d" hidden>
      <h2 style="margin-bottom:6px">3D</h2>
      <p class="muted">Próximamente: OBJ ↔ GLB/GLTF, STL, FBX (normalización de unidades y ejes).</p>
      <div class="note">Si tenés ejemplos concretos (archivos pequeños), podemos probarlos primero.</div>
    </section>
  </main>

  <footer>
    <div class="foot">
      <span class="mono">© <span id="year"></span> ZetaConvert</span>
      <span class="muted">Hecho con foco en velocidad y calidad.</span>
    </div>
  </footer>

  <script>
    // ========= Config =========
    const BACKEND_URL = "https://zetaconvert-backend.onrender.com";

    // ========= Tabs =========
    const tabs = document.querySelectorAll('.tab');
    const panels = {
      "t-imagenes": document.getElementById('tab-imagenes'),
      "t-texto": document.getElementById('tab-texto'),
      "t-extras": document.getElementById('tab-extras'),
      "t-3d": document.getElementById('tab-3d'),
    };
    tabs.forEach(t => {
      t.addEventListener('click', () => {
        tabs.forEach(x => x.setAttribute('aria-selected', x===t ? 'true':'false'));
        Object.values(panels).forEach(p => p.hidden = true);
        panels[t.id].hidden = false;
        document.getElementById('status').textContent = "Esperando archivo…";
      });
    });

    // ========= Imágenes (UI y lógica) =========
    const SUGGESTIONS = {
      ".jpg":  ["png","webp","bmp","tiff"],
      ".jpeg": ["png","webp","bmp","tiff"],
      ".png":  ["jpg","webp","bmp","tiff"],
      ".webp": ["jpg","png","bmp","tiff"],
      ".bmp":  ["jpg","png","webp","tiff"],
      ".tif":  ["jpg","png","webp","bmp"],
      ".tiff": ["jpg","png","webp","bmp"],
      ".gif":  ["png","webp","jpg"]
    };
    const ALL = ["png","jpg","webp","bmp","tiff"];

    const $ = s => document.querySelector(s);
    const fileInput = $("#file");
    const fileInfo = $("#fileInfo");
    const targetSel = $("#target");
    const removeBg = $("#removeBg");
    const tolerance = $("#tolerance");
    const tolVal = $("#tolVal");
    const modeSel = $("#mode");
    const colorInp = $("#color");
    const convertBtn = $("#convertBtn");
    const downloadBtn = $("#downloadBtn");
    const bar = $("#bar");
    const statusEl = $("#status");
    const canvas = $("#preview");
    const ctx = canvas.getContext('2d');
    let lastBlobUrl = null;
    let outName = "convertido.png";
    let imgObj = null;

    function extOf(n){ n=(n||"").toLowerCase(); const i=n.lastIndexOf("."); return i>=0?n.slice(i):""; }
    function setProgress(p,t){ bar.style.width = Math.max(0,Math.min(100,p))+"%"; if(t) statusEl.textContent = t; }
    function drawPreview(file){
      const url = URL.createObjectURL(file);
      const img = new Image();
      img.onload = () => {
        const maxW = canvas.clientWidth || 720;
        const scale = Math.min(maxW / img.width, 1);
        canvas.width = Math.round(img.width * scale);
        canvas.height = Math.round(img.height * scale);
        ctx.clearRect(0,0,canvas.width,canvas.height);
        ctx.drawImage(img,0,0,canvas.width,canvas.height);
        imgObj = img;
        URL.revokeObjectURL(url);
      };
      img.src = url;
    }
    canvas.addEventListener('click', (e) => {
      if (!imgObj) return;
      if (modeSel.value !== 'color') return;
      const r = canvas.getBoundingClientRect();
      const x = Math.floor((e.clientX - r.left) * (canvas.width / r.width));
      const y = Math.floor((e.clientY - r.top) * (canvas.height / r.height));
      const d = ctx.getImageData(x,y,1,1).data;
      const hex = '#'+[d[0],d[1],d[2]].map(v=>v.toString(16).padStart(2,'0')).join('');
      colorInp.value = hex;
    });

    tolerance.addEventListener('input', ()=> tolVal.textContent = tolerance.value);

    fileInput.addEventListener('change', () => {
      downloadBtn.disabled = true;
      if (lastBlobUrl) { URL.revokeObjectURL(lastBlobUrl); lastBlobUrl = null; }
      const f = fileInput.files[0];
      if (!f){
        fileInfo.textContent = "No hay archivo";
        targetSel.disabled = true; targetSel.innerHTML = `<option value="">Elegí un formato…</option>`;
        convertBtn.disabled = true; removeBg.disabled = true; removeBg.checked = false;
        tolerance.disabled = true; modeSel.disabled = true; colorInp.disabled = true;
        setProgress(0,"Esperando archivo…");
        ctx.clearRect(0,0,canvas.width,canvas.height); imgObj=null;
        return;
      }
      drawPreview(f);
      fileInfo.textContent = `${f.name} · ${(f.size/1024/1024).toFixed(2)} MB · ${f.type || 'sin mimetype'}`;
      const opts = SUGGESTIONS[extOf(f.name)] || ALL;
      targetSel.innerHTML = `<option value="">Elegí un formato…</option>` + opts.map(o=>`<option value="${o}">${o.toUpperCase()}</option>`).join("");
      targetSel.disabled = false;
      convertBtn.disabled = true;
      removeBg.disabled = true; removeBg.checked = false;
      tolerance.disabled = true; modeSel.disabled = true; colorInp.disabled = true;
      setProgress(0,"Formato destino pendiente…");
    });

    targetSel.addEventListener('change', () => {
      const f = fileInput.files[0];
      const tgt = targetSel.value;
      const png = tgt === 'png';
      removeBg.disabled = !png; tolerance.disabled = !png; modeSel.disabled = !png;
      colorInp.disabled = !png || modeSel.value !== 'color';
      if (!png) removeBg.checked = false;
      convertBtn.disabled = !(f && tgt);
      if (!convertBtn.disabled) setProgress(0,"Listo para convertir");
    });
    modeSel.addEventListener('change', () => {
      colorInp.disabled = (modeSel.value !== 'color') || removeBg.disabled || !removeBg.checked;
    });
    removeBg.addEventListener('change', () => {
      const on = removeBg.checked && (targetSel.value==='png');
      tolerance.disabled = !on; modeSel.disabled = !on; colorInp.disabled = !on || modeSel.value!=='color';
    });

    convertBtn.addEventListener('click', (e) => {
      e.preventDefault();
      const f = fileInput.files[0]; const target = targetSel.value;
      if (!f || !target) return;

      downloadBtn.disabled = true;
      if (lastBlobUrl) { URL.revokeObjectURL(lastBlobUrl); lastBlobUrl = null; }

      const base = f.name.includes(".") ? f.name.slice(0, f.name.lastIndexOf(".")) : "convertido";
      outName = `${base}.${target}`;

      const xhr = new XMLHttpRequest();
      xhr.open("POST", `${BACKEND_URL}/convert`);
      xhr.responseType = "blob";

      xhr.upload.onprogress = (ev) => {
        if (ev.lengthComputable) {
          const pct = Math.round((ev.loaded/ev.total)*60);
          setProgress(pct, `Subiendo… ${pct}%`);
        } else setProgress(20,"Subiendo…");
      };
      xhr.onprogress = (ev) => {
        if (ev.lengthComputable) {
          const pct = 60 + Math.round((ev.loaded/ev.total)*40);
          setProgress(pct, `Descargando… ${pct}%`);
        } else setProgress(90,"Descargando…");
      };
      xhr.onload = () => {
        if (xhr.status>=200 && xhr.status<300){
          setProgress(100,"Listo ✔️");
          lastBlobUrl = URL.createObjectURL(xhr.response);
          downloadBtn.disabled = false;
        } else {
          const r = new FileReader();
          r.onload = ()=> alert(`Error ${xhr.status}: ${r.result}`);
          r.readAsText(xhr.response);
          setProgress(0,"Error");
          downloadBtn.disabled = true;
        }
      };
      xhr.onerror = () => { setProgress(0,"Error de red"); alert("No se pudo conectar al servidor."); };

      const fd = new FormData();
      fd.append('file', f);
      fd.append('target', target);
      if (target==='png' && removeBg.checked){
        fd.append('remove_bg','1');
        fd.append('tolerance', String(tolerance.value));
        fd.append('remove_bg_mode', modeSel.value);
        if (modeSel.value==='color') fd.append('ref_color', colorInp.value);
      }
      setProgress(5,"Preparando…");
      xhr.send(fd);
    });

    document.getElementById('downloadBtn').addEventListener('click', () => {
      if (!lastBlobUrl) return;
      const a = document.createElement('a'); a.href = lastBlobUrl; a.download = outName;
      document.body.appendChild(a); a.click(); a.remove();
    });

    document.getElementById('year').textContent = new Date().getFullYear();
  </script>
</body>
</html>
