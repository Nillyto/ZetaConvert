<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <link rel="canonical" href="{{ canonical_url }}">
  <title>{% block title %}ZetaConvert · Conversor de archivos online{% endblock %}</title>
  <meta name="description" content="{% block meta_desc %}Convierte imágenes y PDFs en segundos. Gratis, simple y privado.{% endblock %}">
  <meta property="og:title" content="{% block og_title %}ZetaConvert · Conversor de archivos{% endblock %}">
  <meta property="og:description" content="{% block og_desc %}Convertí imágenes y PDFs con un clic.{% endblock %}">
  <meta property="og:type" content="website">
  <meta property="og:url" content="{{ canonical_url }}">
  <meta property="og:image" content="{{ og_image_url }}">
  <meta name="twitter:card" content="summary_large_image">

  <!-- PWA / Icons -->
  <link rel="icon" sizes="192x192" href="{{ url_for('static', path='icons/icon-192.png') }}">
  <link rel="icon" sizes="512x512" href="{{ url_for('static', path='icons/icon-512.png') }}">
  <link rel="manifest" href="{{ url_for('manifest') }}">
  <meta name="theme-color" content="#e1192a">

  <!-- Font -->
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Jost:wght@300..700&display=swap" rel="stylesheet">

  <!-- CSS -->
  <link rel="stylesheet" href="{{ url_for('static', path='css/styles.css') }}?v={{ STYLE_VERSION }}">

  <!-- 👇 CSS mínimo para alinear el icono del buscador a la derecha -->
  <style>
    .nav { display:flex; align-items:center; gap:16px; }
    .brand { display:flex; align-items:center; gap:8px; text-decoration:none; }
    .nav-links { display:flex; align-items:center; gap:12px; margin-left:auto; }
    .nav-search { position:relative; width:min(460px, 38vw); }
    .input-icon-wrap { position:relative; }
    .input-icon-wrap .icon-right {
      position:absolute; right:10px; top:50%; transform:translateY(-50%);
      width:18px; height:18px; pointer-events:none; opacity:.7;
    }
    .input-icon-wrap .search-input {
      width:100%; padding-right:36px; /* espacio para el icono derecho */
    }
    .actions { display:flex; align-items:center; gap:8px; }
    .icon-20 { width:20px; height:20px; display:block; }
  </style>

  {% block extra_head %}{% endblock %}

  <!-- Marca / App -->
  <script type="application/ld+json">
  {"@context":"https://schema.org","@type":"SoftwareApplication","name":"ZetaConvert","applicationCategory":"MultimediaApplication","operatingSystem":"Web","url":"https://zetaconvert.online/","offers":{"@type":"Offer","price":"0","priceCurrency":"USD"}}
  </script>
  <script type="application/ld+json">
  {"@context":"https://schema.org","@type":"WebSite","name":"ZetaConvert","url":"https://zetaconvert.online/","potentialAction":{"@type":"SearchAction","target":"https://zetaconvert.online/?q={q}","query-input":"required name=q"}}
  </script>
  <script type="application/ld+json">
  {"@context":"https://schema.org","@type":"Organization","name":"ZetaConvert","url":"https://zetaconvert.online/","logo":"https://zetaconvert.online/static/icons/icon-512.png","sameAs":["https://github.com/Nillyto/ZetaConvert"]}
  </script>

  <!-- 🎛️ Script de TEMA (único, maestro) -->
  <script>
    (function(){
      const KEY='zc-theme';
      const root=document.documentElement;
      const meta=document.querySelector('meta[name="theme-color"]');
      const prefers=window.matchMedia('(prefers-color-scheme: dark)');
    
      function syncIcon(){
        const el = document.getElementById('themeIcon');
        if (!el) return;
        const dark = root.classList.contains('dark');
        const url  = dark
          ? "{{ url_for('static', path='icons/Sun.svg') }}"
          : "{{ url_for('static', path='icons/Moon.svg') }}";
        el.style.setProperty('--icon-url', `url("${url}")`);
        el.parentElement?.setAttribute('aria-label', dark ? 'Cambiar a tema claro' : 'Cambiar a tema oscuro');
      }
    
      function apply(mode){
        if(mode==='dark'){ root.classList.add('dark');  meta && meta.setAttribute('content','#0f1117'); }
        else{              root.classList.remove('dark');meta && meta.setAttribute('content','#e1192a'); }
        syncIcon();
      }
    
      // Estado inicial (antes de pintar)
      const stored = localStorage.getItem(KEY);
      const initial = stored || (prefers.matches ? 'dark' : 'light');
      if (initial==='dark') root.classList.add('dark');
      apply(initial);
    
      // API global
      window.ZCTheme = {
        set(m){ localStorage.setItem(KEY, m); apply(m); },
        toggle(){ this.set(root.classList.contains('dark') ? 'light' : 'dark'); }
      };
    
      // Cambios del SO si no guardaste preferencia
      prefers.addEventListener('change', e=>{
        if (!localStorage.getItem(KEY)) apply(e.matches ? 'dark' : 'light');
      });
    
      // Click del botón + asegurar icono al montar
      document.addEventListener('DOMContentLoaded', ()=>{
        document.getElementById('toggleTheme')?.addEventListener('click', ()=>window.ZCTheme.toggle());
        syncIcon();
      });
    })();
    </script>
    
    
    

  <!-- Ads (placeholder) -->
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-XXXX" crossorigin="anonymous"></script>
</head>

<body>
  <a class="skip-link" href="#contenido">Saltar al contenido</a>

  <header class="header">
    <nav class="nav">
      <a class="brand" href="{{ url_for('home') }}" aria-label="ZetaConvert">
        <img src="{{ url_for('static', path='icons/icon-192.png') }}" alt="ZetaConvert — Conversor de archivos online" width="28" height="28" loading="eager" fetchpriority="high">
        <span class="brand-name">ZetaConvert</span>
      </a>

      <!-- Buscador en header -->
      <div class="nav-search" role="search">
  <div class="input-icon-wrap">
    <input id="siteSearchTop"
           class="search-input search-input--top input-icon input-icon--right"
           type="text"
           placeholder="Buscar formato o tarea…"
           aria-label="Buscar formato o tarea"
           autocomplete="off">
    <!-- icono a la derecha, hereda color y se vuelve blanco en dark -->
    <span class="icon-mask icon-20 input-icon-right"
      style="--icon-url:url('{{ url_for('static', path='icons/File Search.svg') }}');"></span>

  </div>
  <div id="siteSearchTopPopover" class="popover popover--top" role="listbox" hidden>
    <div id="siteSearchTopList" class="popover-list"></div>
  </div>
</div>


      <ul class="nav-links">
        <li><a href="{{ url_for('home') }}">Inicio</a></li>
        <li><a href="{{ url_for('routes') }}">Herramientas</a></li>
        <li><a href="{{ url_for('privacy') }}">Privacidad</a></li>
        <li><a href="{{ url_for('terms') }}">Términos</a></li>
      </ul>

      <div class="actions">
        <button id="toggleTheme" class="btn compact" type="button" aria-label="Cambiar tema">
          <span id="themeIcon" class="icon-mask"
                style="--icon-url:url('{{ url_for('static', path='icons/Moon.svg') }}');"></span>
        </button>
        
        

        
        <!-- Ejemplo futuro: idioma
        <button class="btn compact" type="button" aria-label="Cambiar idioma" title="Cambiar idioma">
          <img class="icon-20" src="{{ url_for('static', path='icons/Translate.svg') }}" alt="Idioma" width="20" height="20">
        </button>
        -->
      </div>
    </nav>
  </header>

  {% block hero %}{% endblock %}
  <main id="contenido">{% block content %}{% endblock %}</main>

  <footer class="footer">
    <div class="foot">
      <span>© {{ year }} ZetaConvert</span>
      <a href="{{ url_for('ads_txt') }}">ads.txt</a>
    </div>
  </footer>

  <!-- JS -->
  <script src="{{ url_for('static', path='js/main.js') }}" defer></script>

  <!-- SW -->
  <script>
  if ('serviceWorker' in navigator) {
    window.addEventListener('load', () => navigator.serviceWorker.register('/static/js/sw.js').catch(()=>{}));
  }
  </script>

  <!-- Conectar botón de tema + inicializar icono -->
  <script>
  document.addEventListener('DOMContentLoaded', () => {
    document.getElementById('toggleTheme')?.addEventListener('click', () => window.ZCTheme.toggle());
    window.syncThemeIcon && window.syncThemeIcon();
  });
  </script>

  <!-- Buscador header -->
  <script>
  (function(){
    const $ = (s,c=document)=>c.querySelector(s);
    const bust = ()=>`?v=${Date.now()}`;

    const input = $('#siteSearchTop');
    const pop   = $('#siteSearchTopPopover');
    const list  = $('#siteSearchTopList');
    if (!input) return;

    let ROUTES = null;
    async function loadRoutes(){
      if (ROUTES) return ROUTES;
      try{
        const r = await fetch('/formats.json' + bust(), { cache:'no-store' });
        const j = await r.json();
        ROUTES = Array.isArray(j?.items) ? j.items : [];
      } catch { ROUTES = []; }
      return ROUTES;
    }

    function openPop(){ pop.hidden = false; pop.setAttribute('aria-expanded','true'); }
    function closePop(){ pop.hidden = true;  pop.setAttribute('aria-expanded','false'); }

    function render(items){
      list.innerHTML = '';
      items.slice(0, 12).forEach(it=>{
        const a = document.createElement('a');
        a.className = 'popover-item';
        a.href = '/r/' + it.slug;
        const meta = [];
        if (it.from?.length) meta.push('de: ' + it.from.join(', '));
        if (it.to?.length)   meta.push('a: ' + it.to.join(', '));
        a.innerHTML = `<div class="pi-title">${it.title}</div>${meta.length?`<div class="pi-meta">${meta.join(' · ')}</div>`:''}`;
        list.appendChild(a);
      });
    }

    const hay = (d)=>[
      d.title, d.desc, d.category,
      ...(d.from||[]), ...(d.to||[]), ...(d.keywords||[])
    ].join(' ').toLowerCase();

    async function onType(){
      const q = input.value.trim().toLowerCase();
      if (!q){ closePop(); return; }
      const routes = await loadRoutes();
      render(routes.filter(d=> hay(d).includes(q)));
      openPop();
    }

    async function onEnter(e){
      if (e.key !== 'Enter') return;
      const q = input.value.trim().toLowerCase();
      if (!q) return;
      const routes = await loadRoutes();
      const out = routes.filter(d=> hay(d).includes(q));
      if (out.length) window.location.href = '/r/' + out[0].slug;
    }

    input.addEventListener('input', onType);
    input.addEventListener('keydown', onEnter);
    input.addEventListener('focus', () => { if(input.value.trim()) openPop(); });
    document.addEventListener('click', (e)=>{ if(!e.target.closest('.nav-search')) closePop(); });
  })();
  </script>
</body>
</html>
